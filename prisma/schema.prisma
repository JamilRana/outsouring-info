generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// User roles enum
enum UserRole {
  SUBMITTER // HRM-authenticated data providers
  EXPORTER // Local credential report exporters
}

// Main user model
model User {
  id           String   @id @default(uuid())
  email        String   @unique
  name         String?
  role         UserRole
  facilityCode String? // Only for SUBMITTERs
  facilityName String? // Only for SUBMITTERs
  facilityType String?
  division     String?
  district     String?
  upazila      String?

  // For EXPORTERs
  password   String? // Hashed password (only for EXPORTERs)
  exportLogs ExportLog[]

  // Relations
  submissions Submission[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([role])
  @@index([facilityCode])
}

model Designation {
  id           String   @id @default(cuid())
  name         String   @unique 
  category     String

  submissions Submission[]
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@map("designation_tbl")
}

// Outsourcing manpower data
model Submission {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Form fields
  designationId           String
  designation Designation @relation(fields:[designationId], references:[id], onDelete:Cascade)
  
  consolidatedSalary Float
  totalPost          Int
  male               Int
  female             Int

  // Auto-calculated (optional to store)
  totalManpower Int @default(0)
  vacant        Int @default(0)

  // Metadata
  submittedAt  DateTime @default(now())
  facilityCode String // Denormalized for reporting
  facilityName String // Denormalized for reporting

  @@index([userId])
  @@index([facilityCode])
  @@index([submittedAt])
}

// Optional: Audit log for exports
model ExportLog {
  id         String   @id @default(uuid())
  exporterId String
  exporter   User     @relation(fields: [exporterId], references: [id], onDelete: Restrict)
  exportedAt DateTime @default(now())
  filters    Json? // Store applied filters as JSON

  @@index([exporterId])
}
